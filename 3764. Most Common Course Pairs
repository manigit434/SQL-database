Problem:

Table: course_completions

+-------------------+---------+
| Column Name       | Type    | 
+-------------------+---------+
| user_id           | int     |
| course_id         | int     |
| course_name       | varchar |
| completion_date   | date    |
| course_rating     | int     |
+-------------------+---------+
(user_id, course_id) is the combination of columns with unique values for this table.
Each row represents a completed course by a user with their rating (1-5 scale).
Write a solution to identify skill mastery pathways by analyzing course completion sequences among top-performing students:

Consider only top-performing students (those who completed at least 5 courses with an average rating of 4 or higher).
For each top performer, identify the sequence of courses they completed in chronological order.
Find all consecutive course pairs (Course A â†’ Course B) taken by these students.
Return the pair frequency, identifying which course transitions are most common among high achievers.
Return the result table ordered by pair frequency in descending order and then by first course name and second course name in ascending order.

Solution:

WITH TopPerformers AS (
    SELECT 
        user_id
    FROM course_completions
    GROUP BY user_id
    HAVING COUNT(course_id) >= 5
       AND AVG(course_rating) >= 4
),
OrderedCourses AS (
    SELECT 
        cc.user_id,
        cc.course_name,
        cc.completion_date,
        ROW_NUMBER() OVER (PARTITION BY cc.user_id ORDER BY cc.completion_date) AS rn
    FROM course_completions cc
    JOIN TopPerformers tp ON cc.user_id = tp.user_id
),
CoursePairs AS (
    SELECT 
        o1.course_name AS first_course,
        o2.course_name AS second_course
    FROM OrderedCourses o1
    JOIN OrderedCourses o2
      ON o1.user_id = o2.user_id
     AND o1.rn + 1 = o2.rn
)
SELECT 
    first_course,
    second_course,
    COUNT(*) AS transition_count
FROM CoursePairs
GROUP BY first_course, second_course
ORDER BY transition_count DESC, first_course ASC, second_course ASC;
