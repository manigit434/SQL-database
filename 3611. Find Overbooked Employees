Problem:

Table: employees

+---------------+---------+
| Column Name   | Type    |
+---------------+---------+
| employee_id   | int     |
| employee_name | varchar |
| department    | varchar |
+---------------+---------+
employee_id is the unique identifier for this table.
Each row contains information about an employee and their department.
Table: meetings

+---------------+---------+
| Column Name   | Type    |
+---------------+---------+
| meeting_id    | int     |
| employee_id   | int     |
| meeting_date  | date    |
| meeting_type  | varchar |
| duration_hours| decimal |
+---------------+---------+
meeting_id is the unique identifier for this table.
Each row represents a meeting attended by an employee. meeting_type can be 'Team', 'Client', or 'Training'.
Write a solution to find employees who are meeting-heavy - employees who spend more than 50% of their working time in meetings during any given week.

Assume a standard work week is 40 hours
Calculate total meeting hours per employee per week (Monday to Sunday)
An employee is meeting-heavy if their weekly meeting hours > 20 hours (50% of 40 hours)
Count how many weeks each employee was meeting-heavy
Only include employees who were meeting-heavy for at least 2 weeks
Return the result table ordered by the number of meeting-heavy weeks in descending order, then by employee name in ascending order.

Solution:

WITH WeeklyMeetings AS (
    -- Step 1: Calculate total hours per employee per week
    -- WEEK(meeting_date, 1) ensures the week starts on Monday
    SELECT 
        employee_id,
        WEEK(meeting_date, 1) AS week_number,
        YEAR(meeting_date) AS year_number,
        SUM(duration_hours) AS total_weekly_hours
    FROM meetings
    GROUP BY employee_id, year_number, week_number
),
HeavyWeeks AS (
    -- Step 2: Filter for weeks where hours > 20 (50% of 40)
    SELECT 
        employee_id,
        COUNT(*) AS meeting_heavy_weeks
    FROM WeeklyMeetings
    WHERE total_weekly_hours > 20
    GROUP BY employee_id
)
-- Step 3: Join with employee details and filter for at least 2 heavy weeks
SELECT 
    e.employee_id,
    e.employee_name,
    e.department,
    h.meeting_heavy_weeks
FROM employees e
JOIN HeavyWeeks h ON e.employee_id = h.employee_id
WHERE h.meeting_heavy_weeks >= 2
ORDER BY h.meeting_heavy_weeks DESC, e.employee_name ASC;
